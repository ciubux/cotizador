
<div class="modal fade" tabindex="-1" id="modalStockProductoKardex">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalStockProductoKardexTitle"><b>Kardex de almacén en <span id="verNombreSedeKardexProductoStock"></span></b></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <p></p>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-6 col-lg-8">
                        <div class="form-group">
                            <label class="control-label col-xs-2">Producto:</label>
                            <div class="col-xs-10">
                                <span class="form-control-static" id="verNombreProductoStockKardex"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-4">
                        <div class="form-group">
                            <label class="control-label col-xs-4">Código:</label>
                            <div class="col-xs-8">
                                <span class="form-control-static" id="verCodigoProductoStockKardex"></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-8">
                        <div class="form-group">
                            <label class="control-label col-xs-2">Unidad:</label>
                            <div class="col-xs-10">
                                <span class="form-control-static verUnidadMostrarStockKardex"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="col-sm-12 col-lg-12 tableFixHead">
                        <table id="tableMovimientosStockKardex" class="table table-bordered">
                            <thead class="thead-dark">
                                <tr>
                                    <th rowspan="2">Tipo Mov.</th>
                                    <th rowspan="2">Fecha Emisión</th>
                                    <th rowspan="2">Nro. Documento</th>
                                    <th rowspan="2">Unidad Movimiento</th>
                                    <th rowspan="2">Cant. Mov.</th>
                                    <th colspan="2">Stock en:</th>
                                </tr>
                                <tr>
                                    <th><span class="verUnidadMostrarStockKardex"></span></th>
                                    <th><span id="verUnidadConteoStockKardex"></span></th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>



<script type="text/javascript">

    function funcionesModalKardexStockProducto() {
        $(document).on('click', "button.verModalStockProductoKardex", function () {
            var idCiudad = $(this).attr("idCiudad");
            var idProducto = $(this).attr("idProducto");
            var idProductoPresentacion = $(this).attr("idProductoPresentacion");

            $.ajax({
                url: "/Stock/ReporteStockProductoKardex",
                type: 'POST',
                dataType: 'JSON',
                data: {
                    idCiudad: idCiudad,
                    idProducto: idProducto,
                    idProductoPresentacion: idProductoPresentacion
                },
                success: function (kardex) {
                    $("#verNombreSedeKardexProductoStock").html(kardex.ciudad.nombre);
                    $("#verNombreProductoStockKardex").html(kardex.producto.descripcion);
                    $("#verCodigoProductoStockKardex").html(kardex.producto.sku);
                    $(".verUnidadMostrarStockKardex").html(kardex.unidad);
                    $("#verUnidadConteoStockKardex").html(kardex.unidadConteo);

                    var htmlMovimientos = "";
                    var lista = kardex.movimientos;

                    for (var i = 0; i < lista.length; i++) {
                        htmlMovimientos = htmlMovimientos + '<tr>' +
                            '<td>' + lista[i].TipoMovimientoDesc + '</td>' +
                            '<td>' + lista[i].FechaDesc + '</td>';

                        if (lista[i].tipoMovimiento == 99) {
                            htmlMovimientos = htmlMovimientos +
                                '<td></td>' +
                                '<td></td>' +
                                '<td></td>';

                        } else {
                            htmlMovimientos = htmlMovimientos +
                                '<td>' + lista[i].NumeroDocumentoDesc + '</td>' +
                                '<td>' + lista[i].unidadMovimiento + '</td>' +
                                '<td>' + lista[i].cantidadMovimiento + '</td>';
                        }

                        if (lista[i].stockConteo < 0) {
                            htmlMovimientos = htmlMovimientos +
                                '<td style="color:red; font-weight: bold;">' + lista[i].stockUnidad + '</td>' +
                                '<td style="color:red; font-weight: bold;">' + lista[i].stockConteo + '</td>' +
                                '</tr>';
                        } else {
                            htmlMovimientos = htmlMovimientos +
                                '<td>' + lista[i].stockUnidad + '</td>' +
                                '<td>' + lista[i].stockConteo + '</td>' +
                                '</tr>';
                        }
                    }

                    $("#tableMovimientosStockKardex tbody").html(htmlMovimientos);

                    $("#modalStockProductoKardex").modal();
                }
            });
        });
    };


    if (window.addEventListener) // W3C standard
    {
        window.addEventListener('load', funcionesModalKardexStockProducto, false); // NB **not** 'onload'
    }
    else if (window.attachEvent) // Microsoft
    {
        window.attachEvent('onload', funcionesModalKardexStockProducto);
    }

    

   
</script>
