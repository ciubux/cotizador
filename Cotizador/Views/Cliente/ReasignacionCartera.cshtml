@{
    ViewBag.Title = "Reasignar Cartera de Clientes";
    Model.Cliente cliente = ViewBag.cliente;
    List<Model.Cliente> clientes = ViewBag.clientes;
}

<div class="page-header">
    <h3>@ViewBag.Title</h3>
</div>
<div class="container">
    <input type="hidden" id="pagina" value="@ViewBag.pagina" />

    <form action="/Cliente/ReasignarCartera" method="post" id="formReasignarCarteraClientes">
        <input type="hidden" id="fechaInicioVigencia" name="fechaInicioVigencia" value="@cliente.FechaInicioVigenciaDesc" />
        @foreach (Model.Cliente item in clientes)
        {
            <input type="hidden" id="idResignar_@item.idCliente.ToString()" name="idResignar_@item.idCliente.ToString()" class="input-reasignar-asesor" value="" />
        }
    </form>
    <div class="row" style="margin-top: 10px;">
        <div class="col-xs-6 col-lg-4">
            <!--Fecha Inicio Vigencia-->
            <label class="control-label col-xs-3" for="kpiPeriodos">Responsable Comercial:</label>
            <div class="col-xs-9">
                @Html.Action("GetResponsablesComerciales", "Vendedor",
                new
                {
                    vendedorSelectId = "idResponsableComercial",
                    selectedValue = cliente.responsableComercial.idVendedor
                })
            </div>
        </div>

        <div class="col-xs-6 col-lg-4">
            <!--Fecha Inicio Vigencia-->
            <label class="control-label col-xs-3" for="kpiKpis">Sede:</label>
            <div class="col-xs-9">
                @Html.Action("GetCiudades", "Ciudad",
                new
                {
                    ciudadSelectId = "idCiudad",
                    selectedValue = cliente.ciudad.idCiudad
                })
            </div>
        </div>

        <div class="col-sm-6 col-lg-4">
            <div class="form-group">
                <div class="col-xs-4">
                    <label class="control-label">Canales:</label>
                </div>
                <div class="col-xs-8">
                    <div class="row">
                        @if (cliente.perteneceCanalLima)
                        {
                            <input class="radio-input" checked type="checkbox" name="cliente_perteneceCanalLima" id="cliente_CanalLima" value="1">
                        }
                        else
                        {
                            <input class="radio-input" type="checkbox" name="cliente_perteneceCanalLima" id="cliente_CanalLima" value="1">
                        }
                        <label for="cliente_perteneceCanalLima" class="control-label">Lima</label>
                    </div>
                    <div class="row">
                        @if (cliente.perteneceCanalProvincias)
                        {
                            <input class="radio-input" checked type="checkbox" name="cliente_perteneceCanalProvincias" id="cliente_CanalProvincias" value="1">
                        }
                        else
                        {
                            <input class="radio-input" type="checkbox" name="cliente_perteneceCanalProvincias" id="cliente_CanalProvincias" value="1">
                        }
                        <label for="cliente_perteneceCanalProvincias" class="control-label">Provincias</label>
                    </div>
                    <div class="row">
                        @if (cliente.perteneceCanalMultiregional)
                        {
                            <input class="radio-input" checked type="checkbox" name="cliente_perteneceCanalMultiregional" id="cliente_CanalMultireginal" value="1">
                        }
                        else
                        {
                            <input class="radio-input" type="checkbox" name="cliente_perteneceCanalMultiregional" id="cliente_CanalMultireginal" value="1">
                        }
                        <label for="cliente_perteneceCanalMultiregional" class="control-label">Multiregional</label>
                    </div>
                    <div class="row">
                        @if (cliente.perteneceCanalPCP)
                        {
                            <input class="radio-input" checked type="checkbox" name="cliente_perteneceCanalPCP" id="cliente_CanalPCP" value="1">
                        }
                        else
                        {
                            <input class="radio-input" type="checkbox" name="cliente_perteneceCanalPCP" id="cliente_CanalPCP" value="1">
                        }
                        <label for="cliente_perteneceCanalPCP" class="control-label">PCP</label>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <div class="row text-right" style="margin-bottom:10px; margin-right:0px">
        <button id="btnLimpiarBusquedaReasignacion" type="button" class="btn btn-primary  bouton-image botonClean">Limpiar</button>
        <button id="btnBusquedaReasignacion" type="button" class="btn btn-primary  bouton-image botonSearch">Buscar</button>
    </div>


    <div class="row">
        <div class="col-sm-12 col-lg-12">
            <table id="tableClientesReasignar" class="table" data-editing="false"
                    data-editing-allow-add="false"
                    data-editing-allow-delete="false"
                    data-editing-allow-edit="false"
                    data-show-toggle="false">
                <thead>
                    <tr>
                        <th data-name="nombre" data-visible="true" data-sortable="true" data-sorted="true" data-direction="DESC">Razon Social / Nombre</th>
                        <th data-name="ruc" data-visible="true" data-sortable="true">Nro. Documento</th>
                        <th data-name="ciudad" data-visible="true" data-sortable="true">Sede</th>
                        <th data-name="reasignar" data-sortable="true" data-breakpoints="xs">
                            Reasignar A:
                            @if (clientes.Count > 0)
                            {
                                @Html.Action("GetResponsablesComerciales", "Vendedor",
                                            new
                                            {
                                                vendedorSelectId = "idResignarGlobal"
                                            })
                            }
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Model.Cliente item in clientes)
                    {
                        <tr>
                            <td>(@item.codigo) @item.nombreCliente</td>
                            <td>@item.ruc</td>
                            <td>@item.ciudad.nombre</td>
                            <td class="td-reasignar-cartera-a">
                                @Html.Action("GetResponsablesComerciales", "Vendedor",
                                        new
                                        {
                                            vendedorSelectId = "idResignarSel_" + item.idCliente.ToString()
                                        })
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="row text-right" style="margin-bottom:10px; margin-right:0px">
        <button id="btnReasignarCartera" type="button" class="btn btn-success">Reasignar Clientes Cambiados</button>
    </div>
</div>

<script type="text/javascript">

    function funcionesPruebaReasignarCartera() {
        setTimeout(function () {
            $("#idResignarGlobal").change(function () {
                //alert($("#idResignarGlobal").val());
                $(".td-reasignar-cartera-a select.form-control").val($("#idResignarGlobal").val());
                $(".input-reasignar-asesor").val($("#idResignarGlobal").val());
            });

        }, 1000);

        $('body').on('change', ".td-reasignar-cartera-a select.form-control", function () {
            var uuid = $(this).attr("name").replace("idResignarSel_", "");
            alert(uuid);
            $("#idResignar_" + uuid).val($(this).val());
        });

        $("#btnBusquedaReasignacion").click(function () {
            location.reload();
        });

        $("#btnLimpiarBusquedaReasignacion").click(function () {
            $.ajax({
                type: "POST",
                url: actionUrl,
                data: form.serialize(), // serializes the form's elements.
                success: function (data) {
                    $.alert({
                        title: 'Reasignación Exitosa',
                        content: "Se reasignaron los clientes correctamente.",
                        type: 'green',
                        buttons: {
                            OK: function () {
                                location.reload();
                            }
                        }
                    });
                }
            });
        });


        $("#btnReasignarCartera").click(function () {
            var form = $("#formReasignarCarteraClientes");
            var actionUrl = form.attr('action');

            $.ajax({
                type: "POST",
                url: actionUrl,
                data: form.serialize(), // serializes the form's elements.
                success: function (data) {
                    $.alert({
                        title: 'Reasignación Exitosa',
                        content: "Se reasignaron los clientes correctamente.",
                        type: 'green',
                        buttons: {
                            OK: function () {
                                location.reload();
                            }
                        }
                    });
                }
            });
        });
        
    }
    if (window.addEventListener) // W3C standard
    {
        window.addEventListener('load', funcionesPruebaReasignarCartera, false); // NB **not** 'onload'
    }
    else if (window.attachEvent) // Microsoft
    {
        window.attachEvent('onload', funcionesPruebaReasignarCartera);
    }


    
</script>


@section Scripts {
    @Scripts.RenderFormat("<script type=\"text/javascript\" src=\"{0}?nocache=" + TempData["ScriptVersion"] + "\"></script>", "~/bundles/cliente")
}
