@{
    string selectIdAS = this.ViewData.ContainsKey("selectIdAS") ? this.ViewData["selectIdAS"].ToString() : string.Empty;
    string ciudadIdAS = this.ViewData.ContainsKey("ciudadIdAS") ? this.ViewData["ciudadIdAS"].ToString() : string.Empty;
    string selectedValueAS = this.ViewData.ContainsKey("selectedValueAS") ? this.ViewData["selectedValueAS"].ToString() : string.Empty;
    string tipoTextoAS = this.ViewData.ContainsKey("tipoTextoAS") ? this.ViewData["tipoTextoAS"].ToString() : string.Empty;
}

<div class="row">
    <div class="col-sm-12 col-lg-12">
        <select id="@selectIdAS" class="form-control">
        </select>
    </div>
</div>

<script type="text/javascript">

    function funcionesSelectAlmacenesSede() {
        var selectedValueAS = "@selectedValueAS";
        setTimeout(function () {
            var idCiudad = $("#@ciudadIdAS").val();
            funcionesSelectAlmacenesSede(idCiudad)
        }
        , 300);

        $(document).on('change', "#@ciudadIdAS", function () {
            var idCiudad = $(this).val();
            funcionesSelectAlmacenesSede(idCiudad);
        });

        function funcionesSelectAlmacenesSede(idCiudad) {
             $.ajax({
                url: "/Almacen/GetAlmacenesSede",
                data: {
                    idCiudad: idCiudad
                },
                type: 'POST',
                dataType: 'JSON',
                error: function (detalle) {
                    //alert("Ocurrió un problema al obtener el detalle del Pedido N° " + numeroPedido + ".");


                },
                success: function (lista) {
                    var optionsHtml = "";

                    var existeSelectedValue = false;
                    for (var i = 0; i < lista.length; i++) {
                        if (lista[i].esPrincipal && selectedValueAS == "@Guid.Empty") {
                            optionsHtml = optionsHtml + '<option value="' + lista[i].idAlmacen + '" selected>';
                        } else {
                            if (selectedValueAS == lista[i].idAlmacen) {
                                optionsHtml = optionsHtml + '<option value="' + lista[i].idAlmacen + '" selected>';
                                existeSelectedValue = true;
                            } else {
                                optionsHtml = optionsHtml + '<option value="' + lista[i].idAlmacen + '">';
                            }
                        }

                        if ("@tipoTextoAS" == "nombre") {
                            optionsHtml = optionsHtml + lista[i].nombre;
                        }

                        if ("@tipoTextoAS" == "nombreDireccion") {
                            optionsHtml = optionsHtml + lista[i].nombre + " - " + lista[i].direccion;
                        }

                        if ("@tipoTextoAS" == "direccion") {
                            optionsHtml = optionsHtml + lista[i].direccion;
                        }

                        optionsHtml = optionsHtml + '</option>';

                        $("#@selectIdAS").html(optionsHtml);

                    }

                    setTimeout(function () { $("#@selectIdAS").change(); }, 300);

                    if (existeSelectedValue) {
                        selectedValueAS = "@Guid.Empty.ToString()";
                    }
                }
            });
        }
    }

    if (window.addEventListener) // W3C standard
    {
        window.addEventListener('load', funcionesSelectAlmacenesSede, false); // NB **not** 'onload'
    }
    else if (window.attachEvent) // Microsoft
    {
        window.attachEvent('onload', funcionesSelectAlmacenesSede);
    }




</script>
